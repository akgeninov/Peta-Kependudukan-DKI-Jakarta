<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            margin: 20px auto; /* Center horizontally */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: absolute;
            top: 20px; /* Distance from the top of the viewport */
            left: 50%;
            transform: translateX(-50%); /* Center the container horizontally */
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 1200px; /* Optional: Set a maximum width for the container */
            z-index: 1000;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-color: rgba(255, 255, 255, 0.3); /* Warna latar belakang transparan */
            backdrop-filter: blur(4px); /* Efek blur */
            z-index: 0;
        }

        .container * {
            position: relative;
            z-index: 1;
}


        img {
            max-width: 80px; /* Maksimum lebar gambar */
            margin-right: 20px; /* Jarak antara gambar dan teks */
        }

        h1 {
            text-align: center; /* Pusatkan teks */
        }
        #map {
            height: 100%;
        }
        .float-table {
            max-width: 400px; /* Lebar maksimum tabel */
            background-color: white; /* Warna latar belakang tabel */
            border: 1px solid #ccc; /* Garis batas tabel */
            border-radius: 5px; /* Sudut melengkung pada tabel */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); /* Bayangan tabel */
            padding: 10px; /* Padding di dalam tabel */
            margin-bottom: 10px;
        }

        .float-table__header {
            font-weight: bold; /* Teks header tebal */
            background-color: #f5f5f5; /* Warna latar belakang header */
        }

        .float-table__data {
            text-align: left; /* Penjajaran teks di dalam sel data */
            border-bottom: 1px solid #ddd; /* Garis batas bawah sel */
            padding: 8px; /* Padding di dalam sel data */
        }
        #kelurahanSelect{
            height: 40px;
            padding: 10px;
        }
        #barChartContainer {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 300px;
            height: 300px;
            background-color: white;
            border: 1px solid #ccc;
            padding: 10px;
            margin-left: 20px;
        }
        .dropdownContainer {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .dropdownContainer span {
            margin-right: 10px;
            font-weight: bold;
            font-size: 14px;
        }
        .bar-chart-container {
            bottom: 10px;
            z-index: 1000;
            background-color: white;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            border-radius: 5px;
        }


        </style>
        <title>1</title>
    </head>
    <body>
        <div class="container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Coat_of_arms_of_Jakarta.svg/800px-Coat_of_arms_of_Jakarta.svg.png" alt="a">
            <h1>Kependudukan DKI Jakarta</h1>
            <div class="dropdownContainer">
                <span>Kelurahan</span>
                <select id="kelurahanSelect" onchange="highlightKelurahan(this.value)">
                    <option value="">Pilih Kelurahan</option>
                    <!-- Opsi untuk setiap kelurahan akan ditambahkan melalui JavaScript -->
                </select>
            </div>
        </div>
        <div id="map"></div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="data/KepadatanPendudukjiwakm2_1.js"></script>
        <script src="data/Kota_2.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
        }
        var map = L.map('map', {
            zoomControl:true, maxZoom:28, minZoom:1
        }).fitBounds([[-6.417911489066349,106.37359895743943],[-5.888593327025499,107.47017276071178]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        document.querySelector(".leaflet-popup-pane").addEventListener("load", function(event) {
          var tagName = event.target.tagName,
            popup = map._popup;
          // Also check if flag is already set.
          if (tagName === "IMG" && popup && !popup._updated) {
            popup._updated = true; // Set flag to prevent looping.
            popup.update();
          }
        }, true);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_OpenStreetMap_0');
        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
        var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OpenStreetMap_0;
        map.addLayer(layer_OpenStreetMap_0);
        function pop_KepadatanPendudukjiwakm2_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table class="float-table>\
                    <tr>\
                        <th class="float-table__header">Kelurahan</th>\
                        <td class="float-table__data">' + (feature.properties['nama_kelur'] !== null ? autolinker.link(feature.properties['kelurahan'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th class="float-table__header">Kecamatan</th>\
                    <td class="float-table__data">' + (feature.properties['nama_kecam'] !== null ? autolinker.link(feature.properties['nama_kecam'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th class="float-table__header">Kota</th>\
                    <td class="float-table__data">' + (feature.properties['nama_kota'] !== null ? autolinker.link(feature.properties['nama_kota'].toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th class="float-table__header">Luas Wilayah</th>\
                    <td class="float-table__data">' + (feature.properties['csv 3_luas'] !== null ? autolinker.link(feature.properties['csv 3_luas'].toLocaleString()) + ' km<sup>2</sup>' : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th class="float-table__header">Kepadatan (jiwa/km<sup>2</sup>)</th>\
                        <td class="float-table__data">' + (feature.properties['csv 3_kepa'] !== null ? autolinker.link(feature.properties['csv 3_kepa'].toLocaleString()) + ' jiwa/km<sup>2</sup>': '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
            var popup = layer.getPopup();
            var content = popup.getContent();
            var updatedContent = removeEmptyRowsFromPopupContent(content, feature);
            popup.setContent(updatedContent);
        }

        function style_KepadatanPendudukjiwakm2_1_0(feature) {
            if (feature.properties['csv 3_kepa'] >= 0.000000 && feature.properties['csv 3_kepa'] <= 5864.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(254,240,217,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 5864.000000 && feature.properties['csv 3_kepa'] <= 10469.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(254,224,182,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 10469.000000 && feature.properties['csv 3_kepa'] <= 14208.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(253,208,147,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 14208.000000 && feature.properties['csv 3_kepa'] <= 18331.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(253,183,122,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 18331.000000 && feature.properties['csv 3_kepa'] <= 22938.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(252,155,100,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 22938.000000 && feature.properties['csv 3_kepa'] <= 29709.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(246,126,81,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 29709.000000 && feature.properties['csv 3_kepa'] <= 43802.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(235,96,64,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 43802.000000 && feature.properties['csv 3_kepa'] <= 62043.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(222,66,45,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 62043.000000 && feature.properties['csv 3_kepa'] <= 62901.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(200,33,23,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['csv 3_kepa'] >= 62901.000000 && feature.properties['csv 3_kepa'] <= 1000000000000.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukjiwakm2_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(179,0,0,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_KepadatanPendudukjiwakm2_1');
        map.getPane('pane_KepadatanPendudukjiwakm2_1').style.zIndex = 401;
        map.getPane('pane_KepadatanPendudukjiwakm2_1').style['mix-blend-mode'] = 'normal';
        var layer_KepadatanPendudukjiwakm2_1 = new L.geoJson(json_KepadatanPendudukjiwakm2_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_KepadatanPendudukjiwakm2_1',
            layerName: 'layer_KepadatanPendudukjiwakm2_1',
            pane: 'pane_KepadatanPendudukjiwakm2_1',
            onEachFeature: pop_KepadatanPendudukjiwakm2_1,
            style: style_KepadatanPendudukjiwakm2_1_0,
        });
        bounds_group.addLayer(layer_KepadatanPendudukjiwakm2_1);
        map.addLayer(layer_KepadatanPendudukjiwakm2_1);

        function pop_Kota_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });

        var popupContent = '<table class="float-table">\
                <tr>\
                    <th class="float-table__header">Kelurahan</th>\
                    <td class="float-table__data">' + (feature.properties['nama_kelur'] !== null ? autolinker.link(feature.properties['nama_kelur'].toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <th class="float-table__header">Kecamatan</th>\
                    <td class="float-table__data">' + (feature.properties['nama_kecam'] !== null ? autolinker.link(feature.properties['nama_kecam'].toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <th class="float-table__header">Kota</th>\
                    <td class="float-table__data">' + (feature.properties['nama_kota'] !== null ? autolinker.link(feature.properties['nama_kota'].toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <th class="float-table__header">Luas Wilayah</th>\
                    <td class="float-table__data">' + (feature.properties['csv 3_luas'] !== null ? autolinker.link(feature.properties['csv 3_luas'].toLocaleString()) + ' km<sup>2</sup>' : '') + '</td>\
                </tr>\
                <tr>\
                    <th class="float-table__header">Kepadatan (jiwa/km<sup>2</sup>)</th>\
                    <td class="float-table__data">' + (feature.properties['csv 3_kepa'] !== null ? autolinker.link(feature.properties['csv 3_kepa'].toLocaleString()) + ' jiwa/km<sup>2</sup>': '') + '</td>\
                </tr>\
            </table>';

        layer.bindPopup(popupContent, {maxHeight: 400});
        var popup = layer.getPopup();
        var content = popup.getContent();
        var updatedContent = removeEmptyRowsFromPopupContent(content, feature);
        popup.setContent(updatedContent);
        }

        function style_Kota_2_0(feature) {
            switch(String(feature.properties['nama_kota'])) {
                case 'Administrasi Kepulauan Seribu':
                    return {
                pane: 'pane_Kota_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(235,193,129,1.0)',
                interactive: true,
            }
                    break;
                case 'Kota Administrasi Jakarta Barat':
                    return {
                pane: 'pane_Kota_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(118,112,236,1.0)',
                interactive: true,
            }
                    break;
                case 'Kota Administrasi Jakarta Pusat':
                    return {
                pane: 'pane_Kota_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(62,187,215,1.0)',
                interactive: true,
            }
                    break;
                case 'Kota Administrasi Jakarta Selatan':
                    return {
                pane: 'pane_Kota_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(59,221,113,1.0)',
                interactive: true,
            }
                    break;
                case 'Kota Administrasi Jakarta Timur':
                    return {
                pane: 'pane_Kota_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(215,89,229,1.0)',
                interactive: true,
            }
                    break;
                case 'Kota Administrasi Jakarta Utara':
                    return {
                pane: 'pane_Kota_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(210,13,62,1.0)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_Kota_2');
        map.getPane('pane_Kota_2').style.zIndex = 402;
        map.getPane('pane_Kota_2').style['mix-blend-mode'] = 'normal';
        var layer_Kota_2 = new L.geoJson(json_Kota_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Kota_2',
            layerName: 'layer_Kota_2',
            pane: 'pane_Kota_2',
            onEachFeature: pop_Kota_2,
            style: style_Kota_2_0,
        });
        bounds_group.addLayer(layer_Kota_2);
        map.addLayer(layer_Kota_2);
            var title = new L.Control();
            title.onAdd = function (map) {
                this._div = L.DomUtil.create('div', 'info');
                this.update();
                return this._div;
            };
            title.update = function () {
                this._div = L.DomUtil.create('h2');
                this._div.innerHTML = '<h2></h2>';
            };
            title.addTo(map);
        var baseMaps = {};
        // var overlaysTree = [
        //     {label: 'Kota<br /><table><tr><td style="text-align: center;"><img src="legend/Kota_2_AdministrasiKepulauanSeribu0.png" /></td><td>Administrasi Kepulauan Seribu</td></tr><tr><td style="text-align: center;"><img src="legend/Kota_2_KotaAdministrasiJakartaBarat1.png" /></td><td>Kota Administrasi Jakarta Barat</td></tr><tr><td style="text-align: center;"><img src="legend/Kota_2_KotaAdministrasiJakartaPusat2.png" /></td><td>Kota Administrasi Jakarta Pusat</td></tr><tr><td style="text-align: center;"><img src="legend/Kota_2_KotaAdministrasiJakartaSelatan3.png" /></td><td>Kota Administrasi Jakarta Selatan</td></tr><tr><td style="text-align: center;"><img src="legend/Kota_2_KotaAdministrasiJakartaTimur4.png" /></td><td>Kota Administrasi Jakarta Timur</td></tr><tr><td style="text-align: center;"><img src="legend/Kota_2_KotaAdministrasiJakartaUtara5.png" /></td><td>Kota Administrasi Jakarta Utara</td></tr></table>', layer: layer_Kota_2},
        //     {label: 'Kepadatan Penduduk (jiwa/km2)<br /><table><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_058640.png" /></td><td>0 - 5864</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_5864104691.png" /></td><td>5864 - 10469</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_10469142082.png" /></td><td>10469 - 14208</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_14208183313.png" /></td><td>14208 - 18331</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_18331229384.png" /></td><td>18331 - 22938</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_22938297095.png" /></td><td>22938 - 29709</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_29709438026.png" /></td><td>29709 - 43802</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_43802620437.png" /></td><td>43802 - 62043</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_62043629018.png" /></td><td>62043 - 62901</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukjiwakm2_1_6290110000000000009.png" /></td><td>62901 - 1000000000000</td></tr></table>', layer: layer_KepadatanPendudukjiwakm2_1},
        //     {label: "OpenStreetMap", layer: layer_OpenStreetMap_0},
        // ]
        // var lay = L.control.layers.tree(null, overlaysTree,{
        //     //namedToggle: true,
        //     //selectorBack: false,
        //     //closedSymbol: '&#8862; &#x1f5c0;',
        //     //openedSymbol: '&#8863; &#x1f5c1;',
        //     //collapseAll: 'Collapse all',
        //     //expandAll: 'Expand all',
        //     collapsed: true, 
        // });
        // lay.addTo(map);
        // setBounds();
        // var i = 0;
        // layer_KepadatanPendudukjiwakm2_1.eachLayer(function(layer) {
        //     var context = {
        //         feature: layer.feature,
        //         variables: {}
        //     };
        //     layer.bindTooltip((layer.feature.properties['kelurahan'] !== null?String('<div style="color: #323232; font-size: 6pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['kelurahan']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_KepadatanPendudukjiwakm2_1'});
        //     labels.push(layer);
        //     totalMarkers += 1;
        //       layer.added = true;
        //       addLabel(layer, i);
        //       i++;
        // });
        // var i = 0;
        // layer_Kota_2.eachLayer(function(layer) {
        //     var context = {
        //         feature: layer.feature,
        //         variables: {}
        //     };
        //     layer.bindTooltip((layer.feature.properties['nama_kelur'] !== null?String('<div style="color: #323232; font-size: 6pt; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['nama_kelur']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_Kota_2'});
        //     labels.push(layer);
        //     totalMarkers += 1;
        //       layer.added = true;
        //       addLabel(layer, i);
        //       i++;
        // });
        // resetLabels([layer_KepadatanPendudukjiwakm2_1,layer_Kota_2]);
        // map.on("zoomend", function(){
        //     resetLabels([layer_KepadatanPendudukjiwakm2_1,layer_Kota_2]);
        // });
        // map.on("layeradd", function(){
        //     resetLabels([layer_KepadatanPendudukjiwakm2_1,layer_Kota_2]);
        // });
        // map.on("layerremove", function(){
        //     resetLabels([layer_KepadatanPendudukjiwakm2_1,layer_Kota_2]);
        // });

        var legend = L.control({ position: 'bottomright' });

        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'info legend');
            div.innerHTML = '<h4>Legend</h4>';
            return div;
        };

        legend.addTo(map);


        var legends = {
            "Kota": '<h4><center>Kota</center></h4><table>' +
                '<tr><td><img src="legend/Kota_2_AdministrasiKepulauanSeribu0.png" /></td><td>Administrasi Kepulauan Seribu</td></tr>' +
                '<tr><td><img src="legend/Kota_2_KotaAdministrasiJakartaBarat1.png" /></td><td>Kota Administrasi Jakarta Barat</td></tr>' +
                '<tr><td><img src="legend/Kota_2_KotaAdministrasiJakartaPusat2.png" /></td><td>Kota Administrasi Jakarta Pusat</td></tr>' +
                '<tr><td><img src="legend/Kota_2_KotaAdministrasiJakartaSelatan3.png" /></td><td>Kota Administrasi Jakarta Selatan</td></tr>' +
                '<tr><td><img src="legend/Kota_2_KotaAdministrasiJakartaTimur4.png" /></td><td>Kota Administrasi Jakarta Timur</td></tr>' +
                '<tr><td><img src="legend/Kota_2_KotaAdministrasiJakartaUtara5.png" /></td><td>Kota Administrasi Jakarta Utara</td></tr>' +
                '</table>',
                "Kepadatan Penduduk (jiwa/km<sup>2</sup>)": '<h4><center>Kepadatan Penduduk (jiwa/km<sup>2</sup>)</center></h4><table>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_058640.png" /></td><td>0 - 5864</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_5864104691.png" /></td><td>5864 - 10469</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_10469142082.png" /></td><td>10469 - 14208</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_14208183313.png" /></td><td>14208 - 18331</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_18331229384.png" /></td><td>18331 - 22938</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_22938297095.png" /></td><td>22938 - 29709</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_29709438026.png" /></td><td>29709 - 43802</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_43802620437.png" /></td><td>43802 - 62043</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_62043629018.png" /></td><td>62043 - 62901</td></tr>' +
                '<tr><td><img src="legend/KepadatanPendudukjiwakm2_1_6290110000000000009.png" /></td><td>62901 - 1000000000000</td></tr>' +
                '</table>'
        };




        // Membuat kontrol layer dengan checkbox
        var overlays = {
            "Kota": layer_Kota_2,
            "Kepadatan Penduduk (jiwa/km<sup>2</sup>)": layer_KepadatanPendudukjiwakm2_1
        };
        

        var i = 0;
        layer_KepadatanPendudukjiwakm2_1.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip(
                (layer.feature.properties['kelurahan'] !== null ?
                    String('<div style="color: #323232; font-size: 6px; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['kelurahan']) + '</div>' :
                    ''), {
                    permanent: true,
                    offset: [-0, -16]
                });
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
        });
        layer_Kota_2.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip(
                (layer.feature.properties['nama_kelur'] !== null ?
                    String('<div style="color: #323232; font-size: 6px; font-family: \'Open Sans\', sans-serif;">' + layer.feature.properties['nama_kelur']) + '</div>' :
                    ''), {
                    permanent: true,
                    offset: [-0, -16]
                });
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
        });

    resetLabels([layer_KepadatanPendudukjiwakm2_1,layer_Kota_2]);
        map.on("zoomend", function(){
            resetLabels([layer_KepadatanPendudukjiwakm2_1,layer_Kota_2]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_KepadatanPendudukjiwakm2_1,layer_Kota_2]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_KepadatanPendudukjiwakm2_1,layer_Kota_2]);
        });


        var layerControl = L.control.layers(null, overlays, { collapsed: true }).addTo(map);

        map.addLayer(layer_Kota_2);
        legend.getContainer().innerHTML = legends["Kota"];
        legend.getContainer().className += ' kota-legend';

        layerControl.addTo(map);

        var overlays = {
    "Kota": layer_Kota_2,
    "Kepadatan Penduduk (jiwa/km<sup>2</sup>)": layer_KepadatanPendudukjiwakm2_1
};
var overlays = {
    "Kota": layer_Kota_2,
    "Kepadatan Penduduk (jiwa/km<sup>2</sup>)": layer_KepadatanPendudukjiwakm2_1
};

// Fungsi untuk menampilkan layer dan mengatur barchart
layerControl.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'leaflet-control-layers');
    var title = L.DomUtil.create('h3', '', div);
    title.innerHTML = 'Layer';
    title.style.textAlign = 'center';

    for (var name in overlays) {
        var label = L.DomUtil.create('label', '', div);
        var input = L.DomUtil.create('input', '', label);
        input.type = 'radio';
        input.name = 'layer-control';
        input.value = name;

        if (name === 'Kota') {
            input.checked = true; // Select Kota layer by default
            map.addLayer(overlays[name]); // Add Kota layer to the map on load
            legend.getContainer().innerHTML = legends[name]; // Update legend on load
            hideBarChart(); // Hide bar chart for layer Kota
        } else {
            input.checked = false;
            input.style.transform = 'translateY(-30%)';
        }

        var span = L.DomUtil.create('span', '', label);
        span.innerHTML = name;

        input.onchange = function () {
            console.log('Radio button changed');
            var selectedLayerName = this.value;
            console.log('Selected layer:', selectedLayerName);
            for (var key in overlays) {
                if (key === selectedLayerName) {
                    map.addLayer(overlays[key]);
                } else {
                    map.removeLayer(overlays[key]);
                }
            }
            legend.getContainer().innerHTML = legends[selectedLayerName];
            
            // Remove all specific classes
            legend.getContainer().classList.remove('kota-legend');
            legend.getContainer().classList.remove('kepadatan-legend');

            // Add specific class based on selected layer
            if (selectedLayerName === 'Kota') {
                legend.getContainer().classList.add('kota-legend');
                console.log('Hiding bar chart for Kota layer');
                hideBarChart(); // Hide bar chart for layer Kota
            } else if (selectedLayerName === 'Kepadatan Penduduk (jiwa/km<sup>2</sup>)') {
                legend.getContainer().classList.add('kepadatan-legend');
                console.log('Showing bar chart for Kepadatan layer');
                showBarChart('Kelurahan Example', overlays[selectedLayerName]); // Show bar chart when Kepadatan layer is selected
            } else {
                console.log('Hiding bar chart for other layers');
                hideBarChart(); // Hide bar chart for other layers
            }
        };
    }

    return div;
};


layerControl.addTo(map);





        // Array untuk menampung nama-nama kelurahan
// Inisialisasi array nama kelurahan
var kelurahanNames = [];
var originalStyles = {}; // Simpan style asli untuk reset

// Fungsi untuk mengisi dropdown dengan nama kelurahan dari layer
function fillDropdown(layer, propertyName) {
    layer.eachLayer(function(layer) {
        var kelurahanName = layer.feature.properties[propertyName];
        if (kelurahanNames.indexOf(kelurahanName) === -1) {
            kelurahanNames.push(kelurahanName);
            var option = document.createElement("option");
            option.value = kelurahanName;
            option.text = kelurahanName;
            document.getElementById("kelurahanSelect").appendChild(option);
        }
    });
}

// Fungsi untuk mendapatkan warna berdasarkan nama kelurahan
function getKelurahanColor(name) {
    var colors = {
        'Kelurahan1': '#FFEDA0',
        'Kelurahan2': '#FED976',
        'Kelurahan3': '#FEB24C',
        'Kelurahan4': '#FD8D3C',
        'Kelurahan5': '#FC4E2A'
        // Tambahkan lebih banyak warna dan kelurahan sesuai kebutuhan
    };
    return colors[name] || '#FFEDA0'; // Warna default jika nama kelurahan tidak ada dalam colors
}

// Fungsi untuk menyorot kelurahan yang dipilih di layer yang diberikan
function highlightKelurahan(kelurahan, layer, propertyName) {
    // Reset style untuk semua layer
    layer.eachLayer(function(layer) {
        var originalStyle = originalStyles[layer._leaflet_id];
        layer.setStyle(originalStyle); // Atur ulang style ke warna asli
    });

    // Cari layer dengan nama kelurahan yang dipilih dan sorot layer yang sesuai
    layer.eachLayer(function(layer) {
        if (layer.feature.properties[propertyName] === kelurahan) {
            layer.setStyle({
                fillColor: 'yellow', // Warna kuning
                fillOpacity: 0.5 // Opasitas 50%
            });

            var selectedKelurahan = layer.feature.properties[propertyName];
            console.log(selectedKelurahan);
            showKelurahanData(selectedKelurahan, layer);
            // if(layer === '')
            showBarChart(selectedKelurahan, layer);
        }
    });
}

var selectedLayer; // Mendefinisikan variabel global untuk menyimpan layer yang dipilih

function showKelurahanData(selectedKelurahan, layer) {
    var feature = layer.feature;

    function formatProperty(propertyNames) {
        for (var i = 0; i < propertyNames.length; i++) {
            var propertyName = propertyNames[i];
            console.log("Checking property:", propertyName); // Log the property being checked
            if (feature.properties[propertyName] !== undefined && feature.properties[propertyName] !== null) {
                return autolinker.link(feature.properties[propertyName].toLocaleString());
            }
        }
        return ''; // Return an empty string if no property is found
    }

    var popupContent = '<table class="float-table">\
        <tr>\
            <th class="float-table__header">Kelurahan</th>\
            <td class="float-table__data">' + formatProperty(['nama_kelur','kelurahan']) + '</td>\
        </tr>\
        <tr>\
            <th class="float-table__header">Kecamatan</th>\
            <td class="float-table__data">' + formatProperty(['nama_kecam','nama_kecam']) + '</td>\
        </tr>\
        <tr>\
            <th class="float-table__header">Kota</th>\
            <td class="float-table__data">' + formatProperty(['nama_kota','nama_kota']) + '</td>\
        </tr>\
        <tr>\
            <th class="float-table__header">Luas Wilayah</th>\
            <td class="float-table__data">' + (feature.properties['csv 3_luas'] !== null && feature.properties['csv 3_luas'] !== undefined ? autolinker.link(feature.properties['csv 3_luas'].toLocaleString()) + ' km<sup>2</sup>' : '') + '</td>\
        </tr>\
        <tr>\
            <th class="float-table__header">Kepadatan</th>\
            <td class="float-table__data">' + (feature.properties['csv 3_kepa'] !== null && feature.properties['csv 3_kepa'] !== undefined ? autolinker.link(feature.properties['csv 3_kepa'].toLocaleString()) + ' jiwa/km<sup>2</sup>' : '') + '</td>\
        </tr>\
    </table>\
    <button onclick="zoomToSelectedKelurahan()">Zoom</button>';

    layer.bindPopup(popupContent).openPopup();

    // Menyimpan layer yang dipilih ke variabel global
    selectedLayer = layer;
}


function zoomToSelectedKelurahan() {
    // if (selectedLayer) {
        var center = selectedLayer.getBounds().getCenter();
        map.flyTo(center, 13); // Ganti angka 100 dengan tingkat zoom yang diinginkan
    // }
}


// Mengisi dropdown untuk kedua layer
fillDropdown(layer_Kota_2, 'nama_kelur');
fillDropdown(layer_KepadatanPendudukjiwakm2_1, 'nama_kel_1');


// Fungsi untuk menangani klik pada layer
function onLayerClick(e) {
    var layer = e.target; // Mendapatkan layer yang diklik
    var kelurahanName;
    if (layer.feature.properties['nama_kelur']) {
        kelurahanName = layer.feature.properties['nama_kelur']; // Mendapatkan nama kelurahan dari fitur yang diklik pada layer kota
    } else if (layer.feature.properties['nama_kel_1']) {
        kelurahanName = layer.feature.properties['nama_kel_1']; // Mendapatkan nama kelurahan dari fitur yang diklik pada layer kepadatan penduduk
    }
    document.getElementById("kelurahanSelect").value = kelurahanName; // Mengatur nilai dropdown ke nama kelurahan
    highlightKelurahan(kelurahanName, layer_Kota_2, 'nama_kelur');
    highlightKelurahan(kelurahanName, layer_KepadatanPendudukjiwakm2_1, 'nama_kel_1');
}


// Menambahkan event listener untuk klik pada layer
layer_Kota_2.eachLayer(function(layer) {
    layer.on('click', onLayerClick);
});
layer_KepadatanPendudukjiwakm2_1.eachLayer(function(layer) {
    layer.on('click', onLayerClick);
});


// Menerapkan style pada layer saat ditambahkan ke peta dan menyimpan gaya asli
layer_Kota_2.eachLayer(function(layer) {
    var originalStyle = { ...layer.options };
    originalStyles[layer._leaflet_id] = originalStyle; // Simpan gaya asli
});
layer_KepadatanPendudukjiwakm2_1.eachLayer(function(layer) {
    var originalStyle = { ...layer.options };
    originalStyles[layer._leaflet_id] = originalStyle; // Simpan gaya asli
});

// Event listener untuk dropdown
document.getElementById("kelurahanSelect").addEventListener("change", function() {
    var selectedKelurahan = this.value;
    highlightKelurahan(selectedKelurahan, layer_Kota_2, 'nama_kelur');
    highlightKelurahan(selectedKelurahan, layer_KepadatanPendudukjiwakm2_1, 'nama_kel_1');
});

// // Menambahkan kontrol untuk menempatkan canvas pada peta
// var BarChartControl = L.Control.extend({
//     onAdd: function (map) {
//         var div = L.DomUtil.create('div', 'bar-chart-container');
//         var canvas = document.createElement('canvas');
//         canvas.width = 400;
//         canvas.height = 300;
//         canvas.id = 'barChart';
//         div.appendChild(canvas);
//         return div;
//     }
// });

// map.addControl(new BarChartControl({ position: 'bottomleft' })); // Posisi kontrol bisa diubah sesuai kebutuhan

// function drawBarChart(data, kelurahanName) {
//     var ctx = document.getElementById('barChart').getContext('2d');
//     var labels = Object.keys(data);
//     var maleValues = labels.map(label => data[label].male);
//     var femaleValues = labels.map(label => data[label].female);

//     new Chart(ctx, {
//         type: 'bar',
//         data: {
//             labels: labels,
//             datasets: [
//                 {
//                     label: 'Laki-laki',
//                     data: maleValues,
//                     backgroundColor: 'rgba(54, 162, 235, 0.2)',
//                     borderColor: 'rgba(54, 162, 235, 1)',
//                     borderWidth: 1
//                 },
//                 {
//                     label: 'Perempuan',
//                     data: femaleValues,
//                     backgroundColor: 'rgba(255, 99, 132, 0.2)',
//                     borderColor: 'rgba(255, 99, 132, 1)',
//                     borderWidth: 1
//                 }
//             ]
//         },
//         options: {
//             plugins: {
//                 title: {
//                     display: true,
//                     text: 'Jumlah Penduduk Kelurahan: ' + kelurahanName
//                 }
//             },
//             scales: {
//                 y: {
//                     beginAtZero: true
//                 }
//             }
//         }
//     });
// }

// // Fungsi untuk menampilkan bar chart
// function showBarChart(selectedKelurahan, layer) {
//     var feature = layer ? layer.feature : null;

//     // Check if the layer is of type "Kepadatan"
//     if (layer && layer.feature && layer.feature.properties && layer.feature.properties.layerType === 'layer_KepadatanPendudukjiwakm2_1') {
//         // Data sample yang akan ditampilkan
//         var sampleData = {
//             'Usia 35-39': { male: 100, female: 120 },
//             'Usia 40-44': { male: 150, female: 130 },
//             'Usia 45-49': { male: 200, female: 180 },
//             'Usia 50-54': { male: 250, female: 230 },
//             'Usia 55-59': { male: 300, female: 280 },
//             'Usia 60-64': { male: 350, female: 330 },
//             'Usia 65-69': { male: 400, female: 380 },
//             'Usia 70-74': { male: 450, female: 430 },
//             'Usia 75+': { male: 500, female: 480 }
//         };
//         console.log(sampleData);

//         // Memanggil fungsi untuk menampilkan chart
//         drawBarChart(sampleData, selectedKelurahan);
//     } else {
//         console.log('Layer is not of type "Kepadatan". Chart not displayed.');
//     }
// }

// // Contoh pemanggilan fungsi dengan data dummy
// var selectedKelurahan = 'Kelurahan Example';
// var layer = { feature: { properties: { layerType: 'layer_KepadatanPendudukjiwakm2_1' } } }; // Layer dummy
// showBarChart(selectedKelurahan, layer);

// Fungsi untuk menyembunyikan barchart
// Definisikan layer untuk kota dan kepadatan penduduk
// var layer_Kota_2 = L.geoJSON(null, {
//             // Definisi layer Kota
//         });

//         var layer_KepadatanPendudukjiwakm2_1 = L.geoJSON(null, {
//             // Definisi layer Kepadatan Penduduk
//             onEachFeature: function (feature, layer) {
//                 layer.on('click', function () {
//                     showBarChart(feature.properties.nama_kelurahan);
//                 });
//             }
//         });

//         // Definisikan overlays
//         var overlays = {
//             "Kota": layer_Kota_2,
//             "Kepadatan Penduduk (jiwa/km2)": layer_KepadatanPendudukjiwakm2_1
//         };

        // Fungsi untuk menyembunyikan barchart
        function hideBarChart() {
            var barChartContainer = document.getElementById('barChartContainer');
            if (barChartContainer) {
                barChartContainer.style.display = 'none';
            }
        }

var selectedLayer;

        // Fungsi untuk menampilkan barchart
        function showBarChart(selectedKelurahan, layer) {
            var feature = layer.feature;
            
            var sampleData = {
                'Usia 35-39': {
                    male: feature.properties['tabel usia fix_usia_35_39_l'],
                    female: feature.properties['tabel usia fix_usia_35_39_p'],
                },
                'Usia 40-44': {
                    male: feature.properties['tabel usia fix_usia_40_44_l'],
                    female: feature.properties['tabel usia fix_usia_40_44_p'],
                },
                'Usia 45-49': {
                    male: feature.properties['tabel usia fix_usia_45_49_l'],
                    female: feature.properties['tabel usia fix_usia_45_49_p'],
                },
                'Usia 50-54': {
                    male: feature.properties['tabel usia fix_usia_50_54_l'],
                    female: feature.properties['tabel usia fix_usia_50_54_p'],
                },
                'Usia 54-59': {
                    male: feature.properties['tabel usia fix_usia_55_59_l'],
                    female: feature.properties['tabel usia fix_usia_55_59_p'],
                },
                'Usia 60-64': {
                    male: feature.properties['tabel usia fix_usia_60_64_l'],
                    female: feature.properties['tabel usia fix_usia_60_64_p'],
                },
                'Usia 65-69': {
                    male: feature.properties['tabel usia fix_usia_65_69_l'],
                    female: feature.properties['tabel usia fix_usia_65_69_p'],
                },
                'Usia 70-74': {
                    male: feature.properties['tabel usia fix_usia_70_74_l'],
                    female: feature.properties['tabel usia fix_usia_70_74_p'],
                },
                'Usia 75+': {
                    male: feature.properties['tabel usia fix_usia_75+_l'],
                    female: feature.properties['tabel usia fix_usia_75+_p'],
                },
                //tambahkan baris untuk rentang usia lainnya jika diperlukan
            };

            console.log(sampleData);

            drawBarChart(sampleData, selectedKelurahan);

            var barChartContainer = document.querySelector('.bar-chart-container');
            if (barChartContainer) {
                barChartContainer.style.display = 'block';
            }

            selectedLayer = layer;
        }


    // Tampilkan barchart dengan mengatur display menjadi 'block'
    // Simpan referensi ke chart yang ada
var currentChart = null;

function drawBarChart(data, kelurahanName) {
    var ctx = document.getElementById('barChart').getContext('2d');
    
    // Hancurkan chart yang ada jika ada
    if (currentChart) {
        currentChart.destroy();
    }

    var labels = Object.keys(data);
    var maleValues = labels.map(label => data[label].male);
    var femaleValues = labels.map(label => data[label].female);
    var totalValues = labels.map(label => data[label].male + data[label].female);

    // Calculate the total population for all age groups
    var totalPopulation = totalValues.reduce((sum, value) => sum + value, 0);

    currentChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Laki-laki',
                    data: maleValues,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Perempuan',
                    data: femaleValues,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Jumlah',
                    data: totalValues,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1,
                    type: 'line', // Display the total values as a line chart for better readability
                    fill: false
                }
            ]
        },
        options: {
            plugins: {
                title: {
                    display: true,
                    text: 'Kelurahan: ' + kelurahanName + ' (Total Populasi: ' + totalPopulation + ')'
                },
                datalabels: {
                    display: 'auto', // Menampilkan nilai data di atas setiap bar
                    color: 'black'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
    console.log(data);
    console.log(kelurahanName);
}

// Definisikan BarChartControl untuk menambahkan canvas pada peta
var BarChartControl = L.Control.extend({
    onAdd: function (map) {
        var div = L.DomUtil.create('div', 'bar-chart-container');
        var canvas = document.createElement('canvas');
        canvas.width = 400;
        canvas.height = 300;
        canvas.id = 'barChart';
        div.appendChild(canvas);
        div.style.display = 'none'; // Default disembunyikan
        return div;
    }
});

map.addControl(new BarChartControl({ position: 'bottomleft' })); // Posisi kontrol bisa diubah sesuai kebutuhan

// Fungsi untuk menampilkan layer dan mengatur barchart
var overlays = {
    "Kota": layer_Kota_2,
    "Kepadatan Penduduk (jiwa/km<sup>2</sup>)": layer_KepadatanPendudukjiwakm2_1
};

// Fungsi untuk menampilkan layer dan mengatur barchart
layerControl.onAdd = function (map) {
    var div = L.DomUtil.create('div', 'leaflet-control-layers');
    var title = L.DomUtil.create('h3', '', div);
    title.innerHTML = 'Layer';
    title.style.textAlign = 'center';

    for (var name in overlays) {
        var label = L.DomUtil.create('label', '', div);
        var input = L.DomUtil.create('input', '', label);
        input.type = 'radio';
        input.name = 'layer-control';
        input.value = name;

        if (name === 'Kota') {
            input.checked = true; // Select Kota layer by default
            map.addLayer(overlays[name]); // Add Kota layer to the map on load
            legend.getContainer().innerHTML = legends[name]; // Update legend on load
            hideBarChart(); // Hide bar chart for layer Kota
        } else {
            input.checked = false;
            input.style.transform = 'translateY(-30%)';
        }

        var span = L.DomUtil.create('span', '', label);
        span.innerHTML = name;

        input.onchange = function () {
            console.log('Radio button changed');
            var selectedLayerName = this.value;
            console.log('Selected layer:', selectedLayerName);
            for (var key in overlays) {
                if (key === selectedLayerName) {
                    map.addLayer(overlays[key]);
                } else {
                    map.removeLayer(overlays[key]);
                }
            }
            legend.getContainer().innerHTML = legends[selectedLayerName];
            
            // Remove all specific classes
            legend.getContainer().classList.remove('kota-legend');
            legend.getContainer().classList.remove('kepadatan-legend');

            // Add specific class based on selected layer
            if (selectedLayerName === 'Kota') {
                legend.getContainer().classList.add('kota-legend');
                console.log('Hiding bar chart for Kota layer');
                hideBarChart(); // Hide bar chart for layer Kota
            } else if (selectedLayerName === 'Kepadatan Penduduk (jiwa/km<sup>2</sup>)') {
                legend.getContainer().classList.add('kepadatan-legend');
                console.log('Showing bar chart for Kepadatan layer');
                showBarChart('Kelurahan Example', overlays[selectedLayerName]); // Show bar chart when Kepadatan layer is selected
            } else {
                console.log('Hiding bar chart for other layers');
                hideBarChart(); // Hide bar chart for other layers
            }
        };
    }

    return div;
};


layerControl.addTo(map);

// Fungsi untuk menyembunyikan barchart dan mengatur event listener pada layer control
function setupLayerControl() {
    var inputs = document.querySelectorAll('input[name="layer-control"]');
    inputs.forEach(function(input) {
        input.addEventListener('change', function() {
            var selectedLayerName = this.value;
            for (var key in overlays) {
                if (key === selectedLayerName) {
                    map.addLayer(overlays[key]);
                } else {
                    map.removeLayer(overlays[key]);
                }
            }
            legend.getContainer().innerHTML = legends[selectedLayerName];
            
            // Remove all specific classes
            legend.getContainer().classList.remove('kota-legend');
            legend.getContainer().classList.remove('kepadatan-legend');

            // Add specific class based on selected layer
            if (selectedLayerName === 'Kota') {
                legend.getContainer().classList.add('kota-legend');
                console.log('Hiding bar chart for Kota layer');
                hideBarChart(); // Hide bar chart for layer Kota
            } else if (selectedLayerName === 'Kepadatan Penduduk (jiwa/km<sup>2</sup>)') {
                legend.getContainer().classList.add('kepadatan-legend');
                console.log('Showing bar chart for Kepadatan layer');
                showBarChart('Kelurahan Example', overlays[selectedLayerName]); // Show bar chart when Kepadatan layer is selected
            } else {
                console.log('Hiding bar chart for other layers');
                hideBarChart(); // Hide bar chart for other layers
            }
        });
    });
}

setupLayerControl();


        </script>
    </body>
</html>